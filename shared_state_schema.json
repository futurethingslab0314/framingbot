{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "ResearchFramingAgentState",
    "description": "Shared state schema for a multi-skill Research Framing Agent.",
    "type": "object",
    "properties": {
        "raw_input": {
            "type": "string",
            "description": "The original unprocessed input from the user."
        },
        "mode": {
            "type": "string",
            "enum": [
                "Problem-solving",
                "Exploratory",
                "Constructive",
                "Critical",
                "Hybrid"
            ],
            "description": "The epistemic research mode classified by EpistemicModeClassifier."
        },
        "tension": {
            "type": "object",
            "description": "Identifies the core intellectual tension in the research topic.",
            "properties": {
                "dominant_assumption": {
                    "type": "string",
                    "description": "The prevailing assumption the research challenges or interrogates."
                },
                "blind_spot": {
                    "type": "string",
                    "description": "An overlooked perspective or gap in the existing discourse."
                },
                "core_gap": {
                    "type": "string",
                    "description": "The fundamental gap in knowledge the research aims to address."
                }
            },
            "required": [
                "dominant_assumption",
                "blind_spot",
                "core_gap"
            ]
        },
        "research_position": {
            "type": "string",
            "description": "A concise statement of the researcher's stance or framing angle."
        },
        "research_questions": {
            "type": "array",
            "description": "Generated research questions categorized by type.",
            "items": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": [
                            "Mechanism",
                            "Interpretation",
                            "Design space"
                        ],
                        "description": "The structural type of the research question."
                    },
                    "question": {
                        "type": "string",
                        "description": "The research question text."
                    }
                },
                "required": [
                    "type",
                    "question"
                ]
            }
        },
        "selected_rq": {
            "type": "string",
            "description": "The final selected research question to pursue."
        },
        "result_type": {
            "type": "string",
            "enum": [
                "framework",
                "model",
                "typology",
                "critique",
                "guideline",
                "theory"
            ],
            "description": "The expected form of the research contribution or output."
        },
        "contribution": {
            "type": "string",
            "description": "A statement of the intended scholarly or practical contribution."
        },
        "coherence_notes": {
            "type": "object",
            "description": "Coherence assessment from CoherenceChecker across the research framing pipeline.",
            "properties": {
                "logical_gaps": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Breaks in the inferential chain between framing components."
                },
                "scope_issues": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Mismatches in scope or ambition between framing components."
                },
                "alignment_assessment": {
                    "type": "string",
                    "description": "A single summary sentence characterising the overall coherence."
                }
            },
            "required": [
                "logical_gaps",
                "scope_issues",
                "alignment_assessment"
            ]
        },
        "epistemic_profile": {
            "type": "object",
            "description": "A soft distribution of epistemic orientation scores (each 0–1).",
            "properties": {
                "exploratory": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Degree of exploratory orientation."
                },
                "critical": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Degree of critical orientation."
                },
                "problem_solving": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Degree of problem-solving orientation."
                },
                "constructive": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Degree of constructive orientation."
                }
            },
            "required": [
                "exploratory",
                "critical",
                "problem_solving",
                "constructive"
            ]
        },
        "keyword_map": {
            "type": "object",
            "description": "Keywords extracted from user input mapped to each epistemic orientation.",
            "properties": {
                "exploratory": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Keywords signalling exploratory orientation."
                },
                "critical": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Keywords signalling critical orientation."
                },
                "problem_solving": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Keywords signalling problem-solving orientation."
                },
                "constructive": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Keywords signalling constructive orientation."
                }
            },
            "required": [
                "exploratory",
                "critical",
                "problem_solving",
                "constructive"
            ]
        },
        "keyword_roles": {
            "type": "object",
            "description": "Maps each keyword to its epistemic role (e.g. 'explore' → 'exploratory').",
            "additionalProperties": {
                "type": "string",
                "description": "The epistemic role this keyword signals."
            }
        },
        "rule_engine_output": {
            "type": "object",
            "description": "Deterministic outputs derived from the epistemic profile by the rule engine.",
            "properties": {
                "dominant_orientation": {
                    "type": "string",
                    "description": "The primary epistemic orientation determined by the rule engine."
                },
                "rq_templates": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Research question templates matched to the dominant orientation."
                },
                "method_bias": {
                    "type": "string",
                    "description": "Suggested methodological leaning based on the orientation."
                },
                "logic_pattern": {
                    "type": "string",
                    "description": "Expected logical structure pattern for the framing."
                }
            },
            "required": [
                "dominant_orientation",
                "rq_templates",
                "method_bias",
                "logic_pattern"
            ]
        },
        "zotero_analysis_output": {
            "type": "object",
            "description": "Structured output from Zotero literature analysis.",
            "properties": {
                "papers": {
                    "type": "array",
                    "items": {
                        "type": "object"
                    },
                    "description": "Analysed papers from the Zotero collection."
                },
                "themes": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Key themes extracted from the literature."
                },
                "gaps": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Research gaps identified from the literature review."
                }
            }
        }
    },
    "required": [
        "raw_input",
        "mode",
        "tension",
        "research_position",
        "research_questions",
        "selected_rq",
        "result_type",
        "contribution",
        "coherence_notes",
        "epistemic_profile",
        "keyword_map",
        "keyword_roles",
        "rule_engine_output",
        "zotero_analysis_output"
    ]
}